{% extends "admin/voting/base_administrativo.html" %}

{% block title %}Dashboard Administrativo - VoteBem{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item active">Dashboard</li>
{% endblock %}

{% block extra_css %}
<style>
    .dashboard-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px 20px;
        border-radius: 8px;
        margin-bottom: 15px;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .dashboard-header h1 {
        margin: 0;
        font-size: 2em;
        font-weight: 400;
    }
    
    .dashboard-header p {
        margin: 8px 0 0 0;
        font-size: 1em;
        opacity: 0.9;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 12px;
        margin-bottom: 20px;
    }
    
    .stat-card {
        background: white;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        border-left: 3px solid #667eea;
        transition: transform 0.2s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-2px);
    }
    
    .stat-number {
        font-size: 2em;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 5px;
    }
    
    .stat-label {
        font-size: 0.9em;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .admin-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 15px;
    }
    
    .action-card {
        background: white;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        border-top: 3px solid #667eea;
    }
    
    .action-card h3 {
        margin: 0 0 12px 0;
        color: #333;
        font-size: 1.1em;
        font-weight: 600;
    }
    
    .action-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .action-list li {
        margin-bottom: 8px;
    }
    
    .action-list a {
        display: block;
        padding: 8px 12px;
        background: #f8f9fa;
        color: #333;
        text-decoration: none;
        border-radius: 4px;
        transition: all 0.2s ease;
        border-left: 2px solid transparent;
        font-size: 0.9em;
    }
    
    .action-list a:hover {
        background: #667eea;
        color: white;
        border-left-color: #4c63d2;
        transform: translateX(3px);
    }
    
    .quick-stats {
        background: white;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .quick-stats h2 {
        margin: 0 0 12px 0;
        color: #333;
        font-size: 1.3em;
    }
    
    .stats-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid #eee;
    }
    
    .stats-row:last-child {
        border-bottom: none;
    }
    
    .stats-label {
        font-weight: 500;
        color: #666;
    }
    
    .stats-value {
        font-size: 1.2em;
        font-weight: bold;
        color: #667eea;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1>Dashboard Administrativo</h1>
    <p>Bem-vindo ao painel de administração do sistema VoteBem. Aqui você pode gerenciar todas as funcionalidades do sistema.</p>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-number">{{ total_proposicoes }}</div>
        <div class="stat-label">Proposições</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ total_votacoes_disponiveis }}</div>
        <div class="stat-label">Votações Criadas</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ votacoes_ativas }}</div>
        <div class="stat-label">Votações Ativas</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ total_votos_populares }}</div>
        <div class="stat-label">Votos Populares</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ total_congressistas }}</div>
        <div class="stat-label">Congressistas</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ total_votos_congressistas }}</div>
        <div class="stat-label">Votação oficial</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ total_usuarios }}</div>
        <div class="stat-label">Usuários</div>
    </div>
</div>

<div class="admin-actions">
    <div class="action-card">
        <h3>Gerenciar Proposições</h3>
        <ul class="action-list">
            <!-- Tooltip descreve ação e se é via App ou Django -->
            <li><a href="{% url 'gerencial:proposicoes_list' %}" data-bs-toggle="tooltip" data-bs-placement="top" title="Exibe a lista de proposições cadastradas no aplicativo">Listar Todas as Proposições</a></li>
            <li><a href="/admin/voting/proposicao/add/" data-bs-toggle="tooltip" data-bs-placement="top" title="Abre o formulário de criação no Django Admin">Adicionar via Django</a></li>
            <li><a href="{% url 'gerencial:proposicao_add' %}" data-bs-toggle="tooltip" data-bs-placement="top" title="Abre o formulário de criação de proposição no aplicativo">Adicionar via App</a></li>
            <li><a href="{% url 'gerencial:proposicao_import' %}" data-bs-toggle="tooltip" data-bs-placement="top" title="Importa uma proposição informando o ID da Câmara">Adicionar via ID</a></li>
            <li><a href="{% url 'gerencial:proposicoes_statistics' %}" data-bs-toggle="tooltip" data-bs-placement="top" title="Mostra métricas e estatísticas das proposições">Estatísticas de Proposições</a></li>
        </ul>
    </div>
    
    <div class="action-card">
        <h3>Gerenciar Votações</h3>
        <ul class="action-list">
            <!-- Ajuste de rótulo para indicar Django Admin -->
            <li><a href="/admin/voting/votacaodisponivel/" data-bs-toggle="tooltip" data-bs-placement="top" title="Lista todas as votações disponíveis no Django Admin">Listar Todas as Votações via Django</a></li>
            <li><a href="{% url 'gerencial:votacoes_management' %}" data-bs-toggle="tooltip" data-bs-placement="top" title="Ativa, pausa ou encerra votações no aplicativo">Gerenciar Votações Ativas</a></li>
            <li><a href="/admin/voting/votacaodisponivel/add/" data-bs-toggle="tooltip" data-bs-placement="top" title="Cria uma nova votação pelo Django Admin">Criar Nova Votação via Django</a></li>
        </ul>
    </div>
    
    <div class="action-card">
        <h3>Gerenciar Usuários</h3>
        <ul class="action-list">
            <li><a href="/admin/auth/user/" data-bs-toggle="tooltip" data-bs-placement="top" title="Lista todos os usuários no Django Admin">Listar Todos os Usuários via Django</a></li>
            <li><a href="{% url 'gerencial:users_management' %}" data-bs-toggle="tooltip" data-bs-placement="top" title="Exibe estatísticas e atividade de usuários no aplicativo">Estatísticas de Usuários</a></li>
            <li><a href="/admin/users/userprofile/" data-bs-toggle="tooltip" data-bs-placement="top" title="Gerencia perfis de usuários no Django Admin">Perfis de Usuários via Django</a></li>
        </ul>
    </div>
    
    <div class="action-card">
        <h3>Congressistas</h3>
        <ul class="action-list">
            <li><a href="/admin/voting/congressman/" data-bs-toggle="tooltip" data-bs-placement="top" title="Lista deputados no Django Admin">Deputados via Django</a></li>
            <li><a href="/admin/voting/congressman/add/" data-bs-toggle="tooltip" data-bs-placement="top" title="Cria um novo deputado pelo Django Admin">Adicionar Congressista via Django</a></li>
            <li><a href="{% url 'gerencial:congressistas_update' %}" data-bs-toggle="tooltip" data-bs-placement="top" title="Atualiza cadastro de deputados com dados da API da Câmara">Atualizar Deputados (Câmara API)</a></li>
        </ul>
    </div>

    <div class="action-card">
        <h3>Votação oficial</h3>
        <ul class="action-list">
            <li><a href="/admin/voting/congressmanvote/" data-bs-toggle="tooltip" data-bs-placement="top" title="Lista Votação oficial no Django Admin">Votação oficial via Django</a></li>
            <li><a href="{% url 'gerencial:votos_oficiais_app' %}" data-bs-toggle="tooltip" data-bs-placement="top" title="Consulta e analisa Votação oficial no aplicativo">Votação oficial via App</a></li>
        </ul>
    </div>
    
    <div class="action-card">
        <h3>Ferramentas de Dados</h3>
        <ul class="action-list">
            <li><a href="{% url 'gerencial:data_import_export' %}" data-bs-toggle="tooltip" data-bs-placement="top" title="Importa ou exporta dados do sistema pelo aplicativo">Importar/Exportar Dados</a></li>
            <li><a href="/admin/voting/voto/" data-bs-toggle="tooltip" data-bs-placement="top" title="Analisa votos populares no Django Admin">Analisar Votos Populares via Django</a></li>
        </ul>
    </div>
    
    <div class="action-card">
        <h3>Enquetes</h3>
        <ul class="action-list">
            <li><a href="/admin/polls/enquete/" data-bs-toggle="tooltip" data-bs-placement="top" title="Lista e edita enquetes no Django Admin">Gerenciar Enquetes via Django</a></li>
            <li><a href="/admin/polls/respostaenquete/" data-bs-toggle="tooltip" data-bs-placement="top" title="Visualiza respostas de enquetes no Django Admin">Respostas de Enquetes via Django</a></li>
            <li><a href="/admin/polls/enquete/add/" data-bs-toggle="tooltip" data-bs-placement="top" title="Cria nova enquete pelo Django Admin">Criar Nova Enquete via Django</a></li>
        </ul>
    </div>
</div>

{% if votacoes_recentes %}
<div class="quick-stats">
    <h2>Votações Ativas Recentes</h2>
    {% for votacao in votacoes_recentes %}
    <div class="stats-row">
        <div class="stats-label">
            <strong>{{ votacao.titulo }}</strong><br>
        <small>{{ votacao.proposicao_votacao.proposicao.tipo }} {{ votacao.proposicao_votacao.proposicao.numero }}/{{ votacao.proposicao_votacao.proposicao.ano }}</small>
        </div>
        <div class="stats-value">
            {% if votacao.ativo %}Ativa{% else %}Inativa{% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

{% if ultima_proposicao %}
<div class="quick-stats">
    <h2>Última Proposição Adicionada</h2>
    <div class="stats-row">
        <div class="stats-label">
            <strong>{{ ultima_proposicao.titulo }}</strong><br>
            <small>{{ ultima_proposicao.tipo }} {{ ultima_proposicao.numero }}/{{ ultima_proposicao.ano }} - {{ ultima_proposicao.estado }}</small>
        </div>
        <div class="stats-value">
            <!-- Tooltip para link de detalhes no aplicativo -->
            <a href="{% url 'gerencial:proposicao_edit' ultima_proposicao.pk %}" data-bs-toggle="tooltip" data-bs-placement="top" title="Abre detalhes da proposição no aplicativo">Ver Detalhes</a>
        </div>
    </div>
</div>
{% endif %}

{% block extra_js %}
<script>
  // Inicializa tooltips do Bootstrap em todos os elementos com data-bs-toggle="tooltip"
  document.addEventListener('DOMContentLoaded', function () {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.forEach(function (tooltipTriggerEl) {
      new bootstrap.Tooltip(tooltipTriggerEl);
    });
  });
</script>
{% endblock %}
{% endblock %}