{% extends "admin/voting/base_administrativo.html" %}

{% block title %}Gerenciamento de Usuários - VoteBem{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item active">Gerenciamento de Usuários</li>
{% endblock %}

{% block extra_css %}
<style>
    .users-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
    }
    .stat-card {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        text-align: center;
    }
    .stat-number {
        font-size: 2em;
        font-weight: bold;
        color: #007bff;
        margin-bottom: 5px;
    }
    .stat-label {
        color: #6c757d;
        font-size: 0.9em;
    }
    .users-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 20px 0;
    }
    .users-list {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 20px;
    }
    .user-item {
        padding: 15px;
        border-bottom: 1px solid #f8f9fa;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .user-item:last-child {
        border-bottom: none;
    }
    .user-info h4 {
        margin: 0 0 5px 0;
        color: #495057;
    }
    .user-info small {
        color: #6c757d;
    }
    .user-actions {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    .status-badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8em;
        font-weight: bold;
    }
    .status-active {
        background: #d4edda;
        color: #155724;
    }
    .status-inactive {
        background: #f8d7da;
        color: #721c24;
    }
    .btn {
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        text-decoration: none;
        font-size: 0.9em;
        display: inline-block;
    }
    .btn-toggle {
        background: #ffc107;
        color: #212529;
    }
    .btn-edit {
        background: #007bff;
        color: white;
    }
    .btn-primary {
        background: #007bff;
        color: white;
    }
    .vote-count {
        background: #28a745;
        color: white;
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 0.8em;
        margin-left: 5px;
    }
</style>
{% endblock %}

{% block content %}
<h1>Gerenciar Usuários</h1>
<p>Estatísticas e gerenciamento de usuários do sistema VoteBem.</p>

{% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }}" style="padding: 10px; margin: 10px 0; border-radius: 4px; 
             {% if message.tags == 'success' %}background: #d4edda; color: #155724; border: 1px solid #c3e6cb;{% endif %}
             {% if message.tags == 'error' %}background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;{% endif %}">
            {{ message }}
        </div>
    {% endfor %}
{% endif %}

<div class="users-stats">
    <div class="stat-card">
        <div class="stat-number">{{ stats.total_users }}</div>
        <div class="stat-label">Total de Usuários</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ stats.active_users }}</div>
        <div class="stat-label">Usuários Ativos</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ stats.users_with_votes }}</div>
        <div class="stat-label">Usuários que Votaram</div>
    </div>
</div>

<div class="users-container">
    <div class="users-list">
        <h3>Usuários Recentes</h3>
        {% for user in stats.recent_users %}
        <div class="user-item">
            <div class="user-info">
                <h4>{{ user.username }}</h4>
                <small>{{ user.email|default:"Email não informado" }}</small><br>
                <small>Cadastrado em: {{ user.date_joined|date:"d/m/Y H:i" }}</small>
            </div>
            <div class="user-actions">
                <span class="status-badge {% if user.is_active %}status-active{% else %}status-inactive{% endif %}">
                    {% if user.is_active %}Ativo{% else %}Inativo{% endif %}
                </span>
                <form method="post" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="toggle_active">
                    <input type="hidden" name="user_id" value="{{ user.id }}">
                    <button type="submit" class="btn btn-toggle">
                        {% if user.is_active %}Desativar{% else %}Ativar{% endif %}
                    </button>
                </form>
                <a href="{% url 'admin:auth_user_change' user.pk %}" class="btn btn-edit">Editar</a>
            </div>
        </div>
        {% empty %}
        <p>Nenhum usuário encontrado.</p>
        {% endfor %}
    </div>

    <div class="users-list">
        <h3>Top Votantes</h3>
        {% for user in stats.top_voters %}
        <div class="user-item">
            <div class="user-info">
                <h4>
                    {{ user.username }}
                    <span class="vote-count">{{ user.vote_count }} votos</span>
                </h4>
                <small>{{ user.email|default:"Email não informado" }}</small><br>
                <small>Último login: {{ user.last_login|date:"d/m/Y H:i"|default:"Nunca" }}</small>
            </div>
            <div class="user-actions">
                <span class="status-badge {% if user.is_active %}status-active{% else %}status-inactive{% endif %}">
                    {% if user.is_active %}Ativo{% else %}Inativo{% endif %}
                </span>
                <a href="{% url 'admin:auth_user_change' user.pk %}" class="btn btn-edit">Ver</a>
            </div>
        </div>
        {% empty %}
        <p>Nenhum usuário com votos encontrado.</p>
        {% endfor %}
    </div>
</div>

<div style="margin: 30px 0; text-align: center;">
    <a href="/gerencial/dashboard/" class="btn btn-primary">Voltar ao Painel Principal</a>
    <a href="{% url 'admin:auth_user_changelist' %}" class="btn btn-primary" style="margin-left: 10px;">Ver Todos os Usuários</a>
    <a href="{% url 'admin:users_userprofile_changelist' %}" class="btn btn-primary" style="margin-left: 10px;">Perfis de Usuários</a>
</div>

{% endblock %}